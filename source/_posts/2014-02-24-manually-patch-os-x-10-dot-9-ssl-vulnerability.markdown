---
layout: post
title: "Manually patch OS X 10.9 SSL Vulnerability"
date: 2014-02-24 09:19:35 +0100
comments: true
categories: 
---
This is how to apply the "experimental" binary patch for
Security.Framework (64bit only) in OS X 10.9 patching the 
SSL Key Exchange Verification Vulnerability (CVE-2014-1266). 

In case you don't know what I'm talking about, you wont need it since
you don't use Internet.

Be careful!  Damaging the Security binary file will break you machine
immediatelly (see below for a possible rescue action).

### Ok, let's fix the problem:

Dowload the patch from [*SektionEins* web site](http://www.sektioneins.de/en/blog/14-02-22-Apple-SSL-BUG.html)
(many thanks to SektionEins).

Check if it looks like my version:

    $ shasum ~/Downloads/APPLE_SSL_SECURITY_FRAMEWORK_QUICK_AND_DIRTY_64BIT_FIX.bspatch 
    ad2df815503ccece32e7bb7127d9958dd6ee96c7 /Users/horst/Downloads/APPLE_SSL_SECURITY_FRAMEWORK_QUICK_AND_DIRTY_64BIT_FIX.bspatch

Now we change to the binary file, create a backup and a working version.

    $ cd /System/Library/Frameworks/Security.framework/Versions/A
    $ sudo cp Security Security.backup
    $ sudo cp Security Security.unpatched

We are gonna patch the working copy and make it executable.

    $ sudo bspatch Security.unpatched Security.patched ~/Download/APPLE_SSL_SECURITY_FRAMEWORK_QUICK_AND_DIRTY_64BIT_FIX.bspatch
    $ sudo chmod +x Security.patched

Now replace the original file with the patched one.

    $ sudo cp Security.patched Security

Now we open the [test site](https://gotofail.com) to verify our actions.
Congratulations, mission complete.

However, this has only patched the 64 bit version, the 32 bit one is
still vulnerable!

An official Apple patch will hopefully be released within the next days.
_Use that one to replace the workaround we've created now._


### Rescue actions

No problem, everything is fine (as long as you have got a backup of the original
`Security` file).  Switch off your computer and start in single
user mode (press Cmd-S while booting).

Now test the file system integrity:

    /sbin/fsck -fy

Mount the root partition for write with 

    /sbin/mount -uw /

and replace the mentioned file with your backup copy.

When you are done reboot your system with `exit`.


